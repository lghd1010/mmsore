<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DAO.RoundDAO">
	
	
	<select id="getenterCount2" resultType="Integer">
		select count(*) cnt 
		from mmso_1round 
		where mcn_no = ${param1} and m1_enter=${param2} and m1_active = 0 and m1_round_ck = 2
	</select>
	
	<select id="getenterCount3" resultType="Integer">
		select count(*) cnt 
		from mmso_2round 
		where mcn_no = ${param1} and m2_enter=${param2} and  m2_active = 0 and m2_round_ck = 3
	</select>

	
	<select id="competition" resultType="DTO.EnterDTO" >
		select * from mmso_comp_no
		order by mcn_no desc
	</select>
	
	<select id="enterfield" resultType="DTO.EnterDTO">
		select * from mmso_enter_field
		order by mef_idx desc
	</select>

	<select id="admin2roundlist" resultType="DTO.Round1DTO">
		select A.* 
		from (
			    SELECT
			        @ROWNUM := @ROWNUM + 1 AS ROWNUM,
			        m1.*, mm.m_birthday
			    FROM
			        mmso_1round m1, mmso_member2 mm,
			       (SELECT @ROWNUM := 0) R
					where m1_active = 0 and
					m1_round_ck = 2 and
					m1.m1_memberno = mm.memberno and
					mcn_no = ${param1} and
					m1.m1_enter = ${param2}
			) A
		order by m_birthday desc
		
	</select>
	
	<select id="admin3roundlist" resultType="DTO.Round2DTO">
		select A.* 
		from (
			    SELECT
			        @ROWNUM := @ROWNUM + 1 AS ROWNUM,
			        m2.*, mm.m_birthday
			    FROM
			        mmso_2round m2, mmso_member2 mm,
			       (SELECT @ROWNUM := 0) R
					where m2_active = 0 and
					m2_round_ck = 3 and
					m2.m2_memberno = mm.memberno and
					mcn_no = ${param1} and
					m2.m2_enter=${param2} 
			) A
		order by m_birthday desc
		
	</select>
	
	
	<select id="round1pointlist" resultType="DTO.Round1DTO">
			select A.* 
		from (
			    SELECT
			        @ROWNUM := @ROWNUM + 1 AS ROWNUM,
			        ent.* , m1_round_ck, m1_1roundpoint, m1_2roundpoint, m1_3roundpoint, m1_4roundpoint, 
              m1_1roundtime, m1_2roundtime, m1_3roundtime, m1_4roundtime, m1_idx
			    FROM
			        mmso_enter_test ent, mmso_1round m1,
			       (SELECT @ROWNUM := 0) R
					where ent_active = 0 and
					ent.ent_idx = m1.ent_idx and
					ent.mcn_no = ${param1} and
					ent.ent_enter = ${param2}
			) A
		order by ent_birthday desc
	</select>
	
	<update id="admin1roundpointlistck">
		update mmso_1round
			set
				m1_round_ck = 2
			where m1_idx = #{m1_idx}
	</update>
	
	<update id="admin1roundpointupdates">
		update mmso_1round
			set
				m1_1roundpoint = #{m1_1roundpoint},
				m1_2roundpoint = #{m1_2roundpoint},
				m1_3roundpoint = #{m1_3roundpoint},
				m1_4roundpoint = #{m1_4roundpoint}
			where m1_idx = #{m1_idx}
	</update>
	
	<select id="round2pointlist" resultType="DTO.Round2DTO">
		select A.* 
		from (
			    SELECT
			        @ROWNUM := @ROWNUM + 1 AS ROWNUM,
			        ent.* , m2_round_ck, m2_1roundpoint, m2_2roundpoint, m2_3roundpoint, m2_4roundpoint, 
              m2_1time, m2_2time, m2_3time, m2_4time, m2_idx
			    FROM
			        mmso_enter_test ent, mmso_2round m2,
			       (SELECT @ROWNUM := 0) R
					where ent_active = 0 and
					ent.ent_idx = m2.ent_idx and
					ent.mcn_no = #{mcn_no}
			) A
		order by ent_birthday desc
	</select>
	
</mapper>